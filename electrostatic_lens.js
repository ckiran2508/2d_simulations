function run(){function e(){}function t(){V=[];for(let c=k.coordinates.x1-70;c<=p.coordinates.x2+30;c+=10)for(let n=k.coordinates.y1+20;n<=k.coordinates.y3-20;n+=10){var e=Vector.create(c,n),t=Vector.create(0,0);for(let c=0;c<k.points().length;c++){let n=Vector.VectorDiff(e,k.points()[c]);var o=Vector.create(0,0);o.setMag(k.voltage/(n.getMag()*(10*n.getMag()))),o.setDir(n.getDir()),t.addTo(o)}for(let c=0;c<p.points().length;c++){let n=Vector.VectorDiff(e,p.points()[c]);o=Vector.create(0,0);o.setMag(p.voltage/(n.getMag()*n.getMag())),o.setDir(n.getDir()),t.addTo(o)}V.push({x:c,y:n,fieldVector:t})}}function o(){for(let t=0;t<7;t++){var e=Particle.create(35,u-60+20*t,3,"lightgray",10);e.velocity=Vector.create(0,0),v.push(e)}}function n(){for(let t=0;t<v.length;t++){var e=Vector.create(0,0);for(let o=0;o<k.points().length;o++){let c=Vector.VectorDiff(v[t].position,k.points()[o]);e.setMag(k.voltage/(c.getMag()*(10*c.getMag()))),e.setDir(c.getDir()),v[t].acceleration.addTo(e)}for(let o=0;o<p.points().length;o++){let c=Vector.VectorDiff(v[t].position,p.points()[o]);e.setMag(p.voltage/(c.getMag()*c.getMag())),e.setDir(c.getDir()),v[t].acceleration.addTo(e)}}}function i(){for(let e=0;e<v.length;e++)v[e].velocity.addTo(v[e].acceleration)}function r(){for(let e=0;e<v.length;e++)v[e].updatePosition()}function a(){for(let e=0;e<v.length;e++)draw(c,v[e])}function s(){for(let e=0;e<m.length;e++)c.beginPath(),c.arc(m[e].x,m[e].y,1,0,2*Math.PI),c.fillStyle="lightgray",c.fill(),c.stroke(),c.closePath()}function d(){if(f)for(let e=0;e<V.length;e++)c.beginPath(),c.strokeStyle="gray",c.moveTo(V[e].x,V[e].y),c.lineTo(V[e].x+V[e].fieldVector._x*(V.length-e)*75,V[e].y+V[e].fieldVector._y*(V.length-e)*75),c.stroke();c.strokeStyle="black"}function l(){v.length>T&&v.shift()}function g(){c.fillStyle="black",c.font="15px Arial",c.fillText("Accelerating Anode",235,u-150),c.fillText("Focusing Anode",470,u-150),c.fillText("Cathode",14,u-90)}function h(){c.clearRect(0,0,canvas.width,canvas.height),x||(E<20?E++:(o(),E=0),n(),i(),r()),a(),s(),d(),l(),y(),g(),requestAnimationFrame(h)}function y(){c.beginPath(),c.moveTo(10,u-60),c.lineTo(30,u-60),c.lineTo(30,u+60),c.lineTo(10,u+60),c.stroke(),c.beginPath(),c.moveTo(k.coordinates.x1,k.coordinates.y1),c.lineTo(k.coordinates.x2,k.coordinates.y2),c.stroke(),c.beginPath(),c.moveTo(k.coordinates.x3,k.coordinates.y3),c.lineTo(k.coordinates.x4,k.coordinates.y4),c.stroke(),c.beginPath(),c.moveTo((k.coordinates.x1+k.coordinates.x2)/2,k.coordinates.y1),c.lineTo((k.coordinates.x1+k.coordinates.x2)/2,k.coordinates.y1-30),c.stroke(),c.beginPath(),c.moveTo((k.coordinates.x3+k.coordinates.x4)/2,k.coordinates.y3),c.lineTo((k.coordinates.x3+k.coordinates.x4)/2,k.coordinates.y3+30),c.stroke(),c.beginPath(),c.moveTo(p.coordinates.x1,p.coordinates.y1),c.lineTo(p.coordinates.x2,p.coordinates.y2),c.stroke(),c.beginPath(),c.moveTo(p.coordinates.x3,p.coordinates.y3),c.lineTo(p.coordinates.x4,p.coordinates.y4),c.stroke(),c.beginPath(),c.moveTo((p.coordinates.x1+p.coordinates.x2)/2,p.coordinates.y1),c.lineTo((p.coordinates.x1+p.coordinates.x2)/2,p.coordinates.y1-30),c.stroke(),c.beginPath(),c.moveTo((p.coordinates.x3+p.coordinates.x4)/2,p.coordinates.y3),c.lineTo((p.coordinates.x3+p.coordinates.x4)/2,p.coordinates.y3+30),c.stroke(),c.beginPath(),c.moveTo(800,u-110),c.lineTo(10,u-110),c.lineTo(10,u+110),c.lineTo(800,u+110),c.stroke()}document.getElementById("btn-group").style.display="block";canvas.width;var u=canvas.height/2,x=!1,f=!0,v=[],m=[],V=[];const T=300;canvas.addEventListener("mousedown",function(e){e.stopPropagation(),x=!x}),document.addEventListener("keypress",function(e){e.stopPropagation(),x=!x}),document.getElementById("accelerating-anode").children[0].addEventListener("click",function(){document.getElementById("accelerating-anode").children[0].value;f=!f,document.getElementById("accelerating-anode").children[0].value=f?"Hide Electric Field Vectors":"Show Electric Field Vectors"}),document.getElementById("accelerating-anode").children[1].addEventListener("click",function(){var e=document.getElementById("accelerating-anode").children[2].value;if(parseFloat(e.substring(0,e.length-3))>0){var o=(parseFloat(e.substring(0,e.length-3))-.1).toFixed(2);k.voltage=o,document.getElementById("accelerating-anode").children[2].value=o+" kV",t()}}),document.getElementById("accelerating-anode").children[3].addEventListener("click",function(){var e=document.getElementById("accelerating-anode").children[2].value,o=(parseFloat(e.substring(0,e.length-3))+.1).toFixed(2);k.voltage=o,document.getElementById("accelerating-anode").children[2].value=o+" kV",t()}),document.getElementById("focusing-anode").children[0].addEventListener("click",function(){var e=document.getElementById("focusing-anode").children[1].value;if(parseFloat(e.substring(0,e.length-3))>0){var o=(parseFloat(e.substring(0,e.length-3))-1).toFixed(1);p.voltage=o,document.getElementById("focusing-anode").children[1].value=o+" kV",t()}}),document.getElementById("focusing-anode").children[2].addEventListener("click",function(){var e=document.getElementById("focusing-anode").children[1].value,o=(parseFloat(e.substring(0,e.length-3))+1).toFixed(1);p.voltage=o,document.getElementById("focusing-anode").children[1].value=o+" kV",t()}),document.getElementById("reset").addEventListener("click",function(){document.getElementById("accelerating-anode").children[2].value="0.4 kV",document.getElementById("focusing-anode").children[1].value="1 kV",k.voltage=.4,p.voltage=1,t()});Vector.create(50,245),Vector.create(50,265),Vector.create(50,285),Vector.create(50,305),Vector.create(50,325);const k={voltage:.4,coordinates:{x1:240,y1:u-90,x2:360,y2:u-90,x3:240,y3:u+90,x4:360,y4:u+90},points:function(){return[Vector.create(this.coordinates.x1+10,this.coordinates.y1),Vector.create(this.coordinates.x1+30,this.coordinates.y1),Vector.create(this.coordinates.x1+50,this.coordinates.y1),Vector.create(this.coordinates.x1+70,this.coordinates.y1),Vector.create(this.coordinates.x1+90,this.coordinates.y1),Vector.create(this.coordinates.x1+110,this.coordinates.y1),Vector.create(this.coordinates.x3+10,this.coordinates.y3),Vector.create(this.coordinates.x3+30,this.coordinates.y3),Vector.create(this.coordinates.x3+50,this.coordinates.y3),Vector.create(this.coordinates.x3+70,this.coordinates.y3),Vector.create(this.coordinates.x3+90,this.coordinates.y3),Vector.create(this.coordinates.x3+110,this.coordinates.y3)]}},p={voltage:1,coordinates:{x1:460,y1:u-90,x2:580,y2:u-90,x3:460,y3:u+90,x4:580,y4:u+90},points:function(){return[Vector.create(this.coordinates.x1+10,this.coordinates.y1),Vector.create(this.coordinates.x1+30,this.coordinates.y1),Vector.create(this.coordinates.x1+50,this.coordinates.y1),Vector.create(this.coordinates.x1+70,this.coordinates.y1),Vector.create(this.coordinates.x1+90,this.coordinates.y1),Vector.create(this.coordinates.x1+110,this.coordinates.y1),Vector.create(this.coordinates.x3+10,this.coordinates.y3),Vector.create(this.coordinates.x3+30,this.coordinates.y3),Vector.create(this.coordinates.x3+50,this.coordinates.y3),Vector.create(this.coordinates.x3+70,this.coordinates.y3),Vector.create(this.coordinates.x3+90,this.coordinates.y3),Vector.create(this.coordinates.x3+110,this.coordinates.y3)]}};e(),t();var E=0;h()}var canvas=document.querySelector("canvas"),c=canvas.getContext("2d");run();